\SACCMD{markptp}
\label{cmd:markptp}

\SACTitle{概要}
测量并标记信号在测量时间窗内的最大峰峰值

\SACTitle{语法}
\begin{SACSTX}
MARKP!TP! [L!ENGTH! v] [T!O! marker]
\end{SACSTX}

\SACTitle{输入}
\begin{description}
\item [LENGTH v] 设置滑动窗的长度为v秒
\item [TO marker] 指定某个时间标记头段用于保存最小值的所对应的时刻；最大值所对应
    的时刻保存在下一个时间标记头段中。时间标记头段marker可以取Tn(n=0--9)。
\end{description}

\SACTitle{缺省值}
\begin{SACDFT}
markptp length 5.0 to t0
\end{SACDFT}

\SACTitle{说明}
该命令会计算信号在测量时间窗内的最大峰峰值。所谓最大峰峰值，即最大振幅与最小
振幅的振幅差。测量结果中，最小值(波谷)所对应的时刻会写到 \texttt{TO marker} 中所
指定的时间标记头段中，最大值(波峰)所对应的时刻会写到相应的下一个时间标记头段中。
最大峰峰值保存到 \texttt{user0} 中，\texttt{kuser0} 中的值为 \texttt{PTPAMP}。
如果使用 \nameref{cmd:oapf} 打开了字符数字型震相拾取文件，则该命令的结果也会写入到
文件中。

默认情况下，测量时间窗为整个信号，可以使用 \nameref{cmd:mtw} 命令设置新的测量时间窗。
同时，在测量时还需要设置滑动时间窗(sliding time window)的长度。滑动窗的工作原理是，
首先将长度为 \texttt{v} 的滑动窗置于测量时间窗的起始位置，搜索该滑动窗内的最大峰峰值，
然后将长度为 \texttt{v} 的滑动窗向右移动一个数据点，并搜索该滑动窗内的最大峰峰值，
以此类推，直到滑动窗的右边界与测量时间窗的右边界重合为止，此时将有多个最大峰峰值，
最后返回所有最大峰峰值中最大的一个。

对于滑动时间窗(sliding time window)的长度，若stw的长度大于mtw的长度，则 \texttt{stw=mtw}；
若stw的长度小于等于零，则 \texttt{stw=mtw/2}。

\SACTitle{示例}
设置测量时间窗为头段T4和T5之间，并使用默认的滑动时间窗长和时间标记：
\begin{SACCode}
SAC> mtw t4 t5
SAC> markptp
SAC> lh t0 t1 user0 kuser0
\end{SACCode}

设置测量时间窗为初动之后的 \SI{30}{s}，滑动时间窗为 \SI{3}{s}，起始时间标记为T7：
\begin{SACCode}
SAC> mtw a 0 30
SAC> markptp l 3. to t7
SAC> lh t7 t8 user0 user1
\end{SACCode}

\SACTitle{头段变量}
Tn, KTn, user0, kuser0

\SACTitle{相关命令}
\nameref{cmd:mtw}、\nameref{cmd:oapf}

\SACTitle{源码}
\texttt{src/smm/xmarkptp.c}、\texttt{src/smm/ptp.c}
