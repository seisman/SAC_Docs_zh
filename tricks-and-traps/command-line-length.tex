\section{命令长度}
大多数程序在处理命令行的输入时，都会先定义一个固定长度的字符数组，将命令行的
输入读入到字符数组中，再进行进一步的解析。一般来说，这个字符数组是足够大的，
很少会担心命令过长的问题。

那么SAC所能允许的命令的最大长度是多少呢？看一下SAC源码可以知道答案是1001。
考虑到C语言中字符串需要以``\verb+\0+''结尾，所以实际上能够允许的最大长度是1000。

1000这个长度似乎够了，因为大多数SAC命令的长度都不会超过20，而且用户也没有那个
心情去敲一个长度超过1000的命令。一个特殊的情况是命令中包含文件名。

假设在当前目录下有120个形如~\verb+XX.XXX.BHZ+的SAC文件，每个文件的文件名长度为10字符。
如果要将全部SAC文件读入到内存中，最简单的办法是使用通配符：
\begin{SACCode}
SAC> r *.BHZ
\end{SACCode}
当然如果不觉得麻烦，完全可以把120个文件名一个一个敲到命令行里：
\begin{SACCode}
SAC> r XX.001.BHZ XX.002.BHZ ... XX.120.BHZ // 此处省略了一堆文件名
\end{SACCode}

这两种读入SAC文件的方式，看上去很相似，结果却是完全不同的。

前一种方式中，SAC获取的命令长度实际为7字符，远小于1000字符的长度上限，然后SAC
会在程序内部将通配符展开为120个文件的文件列表。

后一种方式中，SAC获取的命令长度超过1200字符，但只有前1000字符会真正被SAC真正接收
并处理，这将导致仅有不到100个SAC文件会被读入，而SAC不会对此给出任何警告。这是一件
非常危险的事情。

这两种方式比较起来，不管是从简便性还是安全性角度来看，都应该选择通配符这种方式。

在脚本中使用通配符，有一点需要注意。以Perl脚本为例，下面的Perl脚本调用了sac，并
读取全部文件，然后做了简单的数据处理，最后保存退出。

\begin{minted}{perl}
#!/usr/bin/evn perl
use strict;
use warnings;

open(SAC, "| sac") or die "Error in opening sac\n";
print SAC "r *.BHZ\n";
print SAC "rmean; rtr; taper\n";
print SAC "bp c 1 3 n 4 p 2\n";
print SAC "w over\n";
print SAC "q\n";
close(SAC);
\end{minted}

上面的脚本是可以正常工作的，但是如果改成如下看上去很像的脚本，则会出问题。
\begin{minted}{perl}
#!/usr/bin/evn perl
use strict;
use warnings;

my @files = glob "*.BHZ";

open(SAC, "| sac") or die "Error in opening sac\n";
print SAC "r @files\n";
print SAC "rmean; rtr; taper\n";
print SAC "bp c 1 3 n 4 p 2\n";
print SAC "w over\n";
print SAC "q\n";
close(SAC);
\end{minted}

两种都使用了通配符或通配函数，前者直接将``\verb+*.BHZ+''传递给SAC，而后者却将
通配(\verb+glob+)后的文件列表传给SAC，所以后者会出现问题。在写脚本的时候应避免后
一种写法。

通配符不是万金油，很多时候我们无法使用通配符来通配一堆没有规律的文件。

例如，当前目录下有200个形如~\verb+XX.XXX.BHZ+的SAC文件，其中140个有清晰的P波，
P波的到时被标记到~\verb+T0+中。现在想要读取这140个有清晰P波的数据，这个时候显然通配符
是没法用了。

错误的写法如下：
\begin{minted}{perl}
#!/usr/bin/evn perl
use strict;
use warnings;

# 获取全部T0有定义的文件名列表
my @files = ();
open(SACLST, "saclst t0 f *.BHZ |");
foreach (<SACLST>) {
    my ($fname, $t0) = split ' ', $_;
    push @files, $fname if $t0 > 0;
}
close(SACLST);

# 调用SAC进行数据处理
open(SAC, "| sac") or die "Error in opening sac\n";
print SAC "r @files\n";
print SAC "rmean; rtr; taper\n";
print SAC "bp c 1 3 n 4 p 2\n";
print SAC "w over\n";
print SAC "q\n";
close(SAC);
\end{minted}

调用SAC进行数据处理的正确写法：
\begin{minted}{perl}
open(SAC, "| sac") or die "Error in opening sac\n";
foreach (@files) {
    print SAC "r more $_\n";
}
print SAC "rmean; rtr; taper\n";
print SAC "bp c 1 3 n 4 p 2\n";
print SAC "w over\n";
print SAC "q\n";
close(SAC);
\end{minted}

效率稍低的正确写法：
\begin{minted}{perl}
open(SAC, "| sac") or die "Error in opening sac\n";
foreach (@files) {
    print SAC "r $_\n";
    print SAC "rmean; rtr; taper\n";
    print SAC "bp c 1 3 n 4 p 2\n";
    print SAC "w over\n";
}
print SAC "q\n";
close(SAC);
\end{minted}
