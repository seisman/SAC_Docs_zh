物理与数学
==========

地震仪一般固定在地表或地下浅层，也有放置在钻孔深处或海底的，因而地震仪
可以直接感知到地面的运动。在地面运动物理量被地震仪接收后，首先要将其转
换为电信号，然后对电信号振幅进行放大以及滤波，再将连续的时间序列离散化，
最终以常见的波形数据的形式表现出来。

概括地说，地面的运动在被地震仪感知之后，需要经历如下三个阶段，最终成为
用户拿到的波形数据：

#. 模拟信号阶段

#. 模数转换

#. 数字信号阶段

地震仪的仪器响应可以表示为频率的复函数，即常说的振幅响应和频率响应。
上面提到的三个阶段，每个阶段的响应函数都是频率的复函数，表示为\ :math:`G_i(f)`\ ，
整个仪器的响应函数是各个阶段响应函数的乘积：

.. math:: G(f)=\prod_i G_i(f)

预备知识
--------

在介绍地震仪的三个阶段之前，需要先了解一些基础的数学知识。

响应函数
~~~~~~~~

模拟信号的响应函数用Laplace变换表示：

.. math:: H(s)=\int_0^{\infty}h(t)e^{-st}dt

数字信号的响应函数用Z变换表示：

.. math:: H(z)=\sum_{-\infty}^{+\infty}h_m z^{-m}

归一化
~~~~~~

频率响应可以表示为

.. math:: G(f)=S_d R(f)


其中\ :math:`R(f)`\ 是频率的函数。在某个特定的频率\ :math:`f_s`\ ，有\ :math:`|R(f_s)|=1.0`\ ，
即\ :math:`R(f)`\ 在频率\ :math:`f_s`\ 处进行归一化。\ :math:`S_d`\ 是放大系数，也称为Sensitivity或者Gain。

R(f)可以表示为

.. math:: R(f)= A_0 H_p(s)


其中\ :math:`H_p(s)`\ 是用零极点表示的transfer函数，一般来说在频率\ :math:`f_s`\ 处这个transfer
函数的振幅响应不为1，所以需要归一化因子\ :math:`A_0`\ 。

FIR滤波器
~~~~~~~~~

FIR滤波器从数学上看就是对数据采样点做加权平均，设计不同的加权系数就得到
不同的FIR滤波器。FIR滤波器一般设计为振幅响应为方阶跃函数（boxcar），因
而其在通带内有较平的振幅响应，在拐角频率处有很尖锐很陡峭的振幅响应变化。
与此同时，滤波器具有线性相位，在时间域造成信号的时间延迟，一般数据采集
系统会对这个时间延迟做校正。因此，用户基本不需要考虑FIR滤波器对仪器响应的影响。

模拟信号阶段
------------

模拟信号阶段会将连续的地面运动物理量（比如速度）转换为连续的电压信号，
并进行电压放大。因而此阶段的输入单位是运动物理量的单位（比如 ），
输出单位是伏特（）。

这个阶段的响应函数可以表示为

.. math:: G(f)=S_d A_0 \frac{\prod_{i=1}^{n} (s-r_i)}{\prod_{j=1}^{n} (s-p_j)}=S_d A_0 H_p(s)

其中，\ :math:`S_d`\ 是放大系数，\ :math:`H_p(s)`\ 是用零极点表示的transfer函数，这里有\ :math:`n`\ 个零点
和\ :math:`m`\ 个极点。\ :math:`A_0`\ 是归一化因子，且\ :math:`s=i 2\pi f`\ 。

假定某仪器的自然频率为\ :math:`f_0=\SI{1}{\Hz}`,
阻尼常数为\ :math:`\lambda=0.7`\ 。如果该仪器是一个
相对简单的仪器，则该仪器的加速度传递函数为：

.. math:: H(s) = \frac{s}{s^2+2\lambda \omega_0 s + \omega_0^2}

几点说明：

-  该传递函数仅表示某一类地震仪的传递函数，现代地震仪的传递函数可能
   比这个要复杂；

-  根据该传递函数，很容易计算出它的一个零点和两个极点；

已知该仪器在\ :math:`f_s=\SI{1}{\Hz}`\ 时的增益为\ :math:`Sd=\SI{150}{\V\per(\m\per\square\s)}`\ ，
即若仪器接收到 1 频率的加速度 1 ²， 则仪器的输出电压为
150。因而仪器真实的传递函数还需要把增益加进去：

.. math:: G(f) = R(f)*S_d = A_0*H_p(s)*S_d

其中\ :math:`A_0`\ 是归一化因子，保证在频率\ :math:`f=f_s`\ 处有\ :math:`|R(f_s)|=1.0`\ 。

模数转换
--------

模数转换器，将上一阶段产生的连续电压信号转换为离散的电压信号。
输入的单位是伏特 ，输出单位是 。这个阶段，所有频段
有相同的振幅响应，即只存在一个放大系数，同时可能存在一个时间延迟。

假设模数转换器是 :math:`m` 位，电压范围是 :math:`\pm n` ，那么
:math:`\SI{1}{counts}=\frac{2n}{2^m} \si{\V}`\ ，电压也能精确到\ :math:`\frac{2n}{2^m} \si{\V}`\ 。
例如， 位模数转换器的输入电压范围是 +-20，则输出的最大
范围是\ :math:`\pm 2^{23}` 。因而ADC的放大系数为

.. math:: S_d = \SI[exponent-base = 2]{e24/40}{counts\per\V} = \SI{4.1943e5}{counts\per\V}

 即若ADC接收到的输入电压为 1，则其输出为 4.1983e5 counts。
结合地震仪的放大系数可知，频率为 1 的 1 ²
的地面运动加速度在ADC的输出为：

.. math::

   \SI{1}{\m\per\square\s} *
       \SI{150}{\V\per{(\m\per\square\s)}} *
       \SI{4.1943e5}{counts\per\V} =
       \SI{6.29145e7}{counts}

另一方面，由于ADC的输入电压的上限为 20，因而仪器所能记录的
最大加速度为\ :math:`20/150=\SI{0.13}{\m\per\square\s}`\ 。

数字信号阶段
------------

这个阶段会对数据信号进行进一步的处理，主要包含三个部分，即离散信号
滤波、数据重采样、时间延迟校正。

离散信号滤波可以采用FIR滤波器，也可以采用IIR滤波器。多数情况下采用
FIR滤波器，而FIR滤波器的振幅响应函数可以认为在全频段内为1 [1]_，因而这个阶段只
需要考虑放大系数，而不需要再考虑由于滤波引入的响应函数。同样，对于
数据重采样以及时间校正也不会引入新的响应函数。

小结
----

综上所述，三个阶段中，第一个阶段最为复杂，需要给出放大系数\ :math:`Sd_{1}`\ 、归一化
因子\ :math:`A_0`\ 以及零极点信息；第二个阶段以及第三个阶段都只需要给出放大系数\ :math:`Sd_{2}`\ 和\ :math:`Sd_3`\ 。
最终得到仪器的响应函数为

.. math:: G(f)=Sd_1 A_0 H_p(s) Sd_2 Sd_3=Sd_0 A_0 H_p(s)


即需要仪器在第一个阶段的零极点信息、归一化因子\ :math:`A_0`\ 以及三个阶段的放大系数的
乘积\ :math:`Sd_0`\ 即可以近似表示地震仪的仪器响应。

.. [1]
   FIR滤波器在Nyquist频率附近会有5%左右的震荡，因而若感兴趣的频率与
   Nyquist频率相差较大，则可以忽略这一阶段的响应函数
