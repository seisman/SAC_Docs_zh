apk
===

概要
----

对波形使用自动事件拾取算法（由连续信号判断是否其中是否包含地震事件）

语法
----

.. code-block:: console

    APK [param v [param v] ... ] [Validation ON|OFF]

输入
----

param v
    给参数赋值，param 的可能取值在说明中会说到。

VALIDATION ON/OFF
    打开/关闭震相检验

缺省值
------

.. code-block:: console

    apk c1 0.985 c2 3.0 c3 0.6 c4 0.03 c5 5.0 c6 0.0039 c7 100. c8 -0.1
        d5 2. d8 3. d9 1. i3 3 i4 40 i6 3 validation on

说明
----

用于自动震相拾取的算法最初来自于 USGS 的 Rex Allen 的工作。

事件的检测依据是基于信号短期滑动平均值与长期滑动平均值的比值的突变。
一旦事件被检测到，这次拾取将被赋予一个可选的验证状态以试图从噪声中
区分出真正的事件。一旦检测到的事件的有效性被确认，这次读取到的事件
将被计算以决定事件的其他特征。目前只能给出事件持续的时间，如果需要
其他比如最大振幅、周期以及衰减率之类的信息也可以加入。注意这里检测
的是一次事件而非一个震相！

这个命令的大多数参数永远不需要改变，如果用户想要改进算法这些参数也
可以做修改。这些参数中的大多数和参考文献中有相同的含义：

-  C1 是用于滤去直流偏差的递归高通滤波器中的常数
-  C2 是用于改变特征函数的振幅以及一阶微分的权重的常数
-  C3 是用于计算特征函数的短期平均值的时间常数
-  C4 是用于计算特征函数的长期平均值的时间常数
-  C5 是用于计算参考水平阀值的常数。当信号的短期平均值大于 C5 乘以长期
   平均值，那么这样一个信号就是一个有效事件
-  C6 是用于计算滤波后数据的滑动平均绝对值的时间常数
-  C7 当特征函数的绝对值大于 C7 则认为此台站无效
-  C8 是用于确定信号终止的参数。当信号的绝对值低于 C8 的时间超过 D8 秒则
   认为信号已经终止。目前有两种不同的算法所以C8有两种不同的解释。如果
   C8 为正，那么终止水平为 C8 乘以事件到达之前的信号的滑动平均绝对值。
   这个方法对于对于背景噪声很大的台站是很有用的。如果 C8 为负，则终止
   水平为 C8 的绝对值。如果噪声水平比终止水平低的多，则这种方法将给出
   不同台站的较为一致的终止判据。
-  D5是一个事件被判定为有效所要达到的最小持续时间的秒数。
-  D9是用于初始化特征函数长期平均值的持续时间值的，单位为秒
-  I3、I4 和 I6 是用于震相验证的整型常数，需要保证不被改变

头段变量改变
------------

事件读取到的时间储存在 ``A``\ （即初动到时）中，检测质量和运动方向储存在
``KA`` 中，事件结束时间储存在 ``F`` 中。

示例
----

.. code-block:: console

    SAC> fg seis                # 利用这个数据做个例子
    SAC> lh a                   # 这个数据本身是标有 A 的，即初动到时
         a = 1.046400e+01
    SAC> apk v on               # apk，且打开震相验证
     CDV IPD0 81 329103824.49   # 台站名，KA 的值，后面两个不知道是什么
    SAC> lh a ka f
          a = 1.049000e+01      # 新标记的初动到时，可以 p 看一下效果
         ka = IPD0              # 初动信息，I 表示急始，P 表示初动P 波，
                                # D 表示初动向下，0 不清楚
    SAC> apk v off              # apk，关闭震相验证
     CDV -123 81 329103824.49   53897
    SAC> lh a ka f
         a = 1.049000e+01       # 初始震相
         f = 5.389773e+06       # 事件结束，这里的 f 好像有问题？
