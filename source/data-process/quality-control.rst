质量控制
========

质量控制就是标记/删除信噪比低或不合适的波形。

用户可以自己在程序中判断数据的好坏以进行质量控制，但这样做很困难，
因为实际情况中，会遇到各种奇形怪状的“坏”波形，很难用统一的程序将
这些“坏”波形挑选出来，所以更多时候需要人工的参与。

一种常规的做法如下：

.. code-block:: bash

    SAC> r *.SAC        # 读入全部的 SAC 数据
    SAC> ppk p 5        # plotpk，每次绘制5个波形
    # 若波形质量很差，则用 t9 标记
    SAC> wh
    SAC> q

解释一下以上做法，首先读入所有的 SAC 数据，然后利用 :doc:`/commands/plotpk`\ ，
每次绘制 n 个波形，如果是3分量数据，n 一般取3。若波形质量很好，则不理会；
若波形质量很差，则在波形的任意时刻标记 ``t9`` 的值（具体如何标记
可以参考下一节的内容），然后使用 ``wh`` 将标记的 ``t9`` 保存
到头段中，再退出 SAC。

完成上面的步骤之后，所有“坏”波形的 ``t9`` 都被标记，一般来说都
是一个正值，而所有“好”波形的 ``t9`` 则都处于未定义状态，其值为
``-12345.0``\ 。

鉴于此，可以通过如下命令删除“坏”波形：

.. code-block:: console

    $ saclst t9 f *.SAC | awk '$2>0 {print "rm",$1}' | sh

.. attention::

   一定要在理解该命令的含义的前提下才可使用，否则可能会造成数据的丢失！

当然，也可以用如下命令将“坏”数据移动到专门的目录中：

.. code-block:: console

    $ mkdir BAD
    $ saclst t9 f *.SAC | awk '$2>0 {print "mv", $1, "BAD/"}' | sh

``awk`` 命令中，目录名 BAD 后最好加上斜杠。若不加斜杠，且忘记新建目录 BAD，
则所有应该放在目录 BAD 中的文件都会被重命名为 BAD，进而导致文件丢失。
