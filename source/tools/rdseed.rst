rdseed
======

``rdseed`` 可以读取 SEED 格式，从中提取出波形信息，并将波形数据保存
为 SAC、AH、CSS、SEGY 或 ASCII 等多种数据格式。

语法说明
--------

终端键入 ``rdseed -h`` 即可查看 ``rdseed`` 的选项及语法说明。\ ``rdseed``
命令的选项众多，下面按照选项的重要性从高到低排序。

比较重要且常用的选项：

-  ``-f file``\ ：输入的 SEED 文件名。\ ``rdseed`` 一次只能处理一个 SEED 文件。
-  ``-d``\ ：从SEED数据中提取波形数据
-  ``-o n``\ ：输出波形数据的格式，默认为 SAC 格式。\ ``n`` 可以取 1–9，
   分别表示 SAC（1）、AH（2）、CSS（3）、miniSEED（4）、SEED（5）、SAC ASCII（6）、
   SEGY（7）、Simple ASCII(SLIST)（8）和 Simple ASCII(TSPAIR)（9）。
-  ``-R``\ ：输出 RESP 格式的仪器响应文件
-  ``-p``\ ：输出 SAC PZ 格式的仪器响应文件
-  ``-E``\ ：输出的波形数据的文件名中包含结束时间
-  ``-q``\ ：指定输出目录，该目录必须已经存在。默认输出到当前目录。
-  ``-Q``\ ：选择波形数据的质量，可以取 ``E``\ 、\ ``D``\ 、\ ``M``\ 、
   ``R``\ 、\ ``Q``\ ，其中 ``E`` 代表输出全部质量的波形数据，
   其他值的含义参考 :doc:`/data-process/quality-control` 一节。
-  ``-b n``\ ：输出的波形数据的最大数据点数，默认值为 20000000，
   能所取到的最大值是4字节整型的上限，即 2147483647。若波形数据的的数据
   点数超过该值，则会给出警告并把数据分割成多段。
-  ``-g file``\ ：为 SEED 或 miniSEED 数据单独指定响应文件。响应文件
   可以是 SEED 格式也可以是 dateless SEED 格式，也可以通过设置环境变量
   ``ALT_RESPONSE_FILE`` 指定响应文件，这样做的好处在于可以多个 SEED
   文件共用一个响应文件
-  ``-h`` 或 ``-u``\ ：显示命令的用法
-  ``-z n`` \ ：检查并校正数据极性,参考接下来的 :ref:`subsec:polarity-correction` 一节

不常用的选项：

-  ``-a``\ ：提取缩略词词典
-  ``-c``\ ：提取文件内容的目录信息
-  ``-C STN|CHN``\ ：提取台站或分量的注释信息
-  ``-l``\ ：列出每个 block 的内容
-  ``-s``\ ：输出全部台站的 RESP 格式仪器响应文件到终端
-  ``-S``\ ：提取台站的汇总信息到文件 ``rdseed.stations``\ ，
   内容包括台站名、台网名、经纬度、海拔、分量、台站开始时间和结束时间
-  ``-t``\ ：输出波形相关信息到终端，包括台站名、分量名、台网名、
   位置码、质量控制符、波形开始时间和结束时间、采样率、数据点数
-  ``-v n``\ ：选择卷号，默认值为1。对于 SEED 文件 ``n`` 只能取 1
-  ``-k`` 跳过数据点数为0的记录
-  ``-e``\ ：提取事件/台站数据到文件 ``rdseed.events``
-  ``-i``\ ：忽略位置码
-  ``-x file``\ ：使用 ``JWEED`` 生成的 summary 文件，根据summary 文件
   提取指定台站、分量和时间窗内的波形数据

.. _subsec:polarity-correction:

正负极性及其校正
----------------

地震仪的每个分量都有一个传感器，每个传感器都有一个敏感轴，仪器记录的就是
敏感轴方向的运动物理量。每个敏感轴都有一个正方向，若地面运动与敏感轴的正
方向一致，则输出为正值，若地面运动与敏感轴的正方向相反，则输出为负值。

SAC 头段中的 ``cmpaz`` 和 ``cmpinc`` 是用于描述仪器敏感轴正方向
的最通用也是最准确的方法。几个比较特殊的方向是：垂直方向、正东西向、
正南北向，在SAC中方位码分别为 ``Z``\ 、\ ``E`` 和 ``N``\ 。下表
列出了这六个方向所对应的 ``cmpaz`` 和 ``cmpinc``\ 。

.. table:: 6个标准方向的 cmpaz 和 cmpinc

   ========= ========== ========= ======= ======
   方向      cmpaz      cmpinc    方位码  极性
   ========= ========== ========= ======= ======
   垂直向上  0          0         Z       正
   垂直向下  0          180       Z       负
   正北      0          90        N       正
   正南      180        90        N       负
   正东      90         90        E       正
   正西      270        90        E       负
   ========= ========== ========= ======= ======

对于一个方位码为 ``Z`` 的数据，其分量方向有两种可能性：垂直向上和
垂直向下。根据 SAC 中 NEU 坐标系的定义（ :numref:`figure:cmpaz-cmpinc` ），垂直
向上方向为正极性，垂直向下方位为负极性。同理，正东和正北是正极性，正西
和正南为负极性。

由上表可知，通过检查分量的 ``cmpaz`` 和 ``cmpinc`` 即可判断是
是正极性还是负极性。某些情况下，分量角度是正常的，但仪器响应中的总增益
是负值，也可用于表示负极性，但这种情况很少见到，目前缺乏数据做测试，因而
暂且先不考虑增益为负的这种情况。

``rdseed`` 中 ``-z n`` 选项可以用于检测并校正负极性。

-  ``n=0`` 表示不做极性检测；
-  ``n=1`` 表示只检查 ``cmpaz`` 或 ``cmpinc``\ ；若是负
   极性，则反转所有数据点的正负号并修改 ``cmpaz`` 或 ``cmpinc`` 的值；
-  ``n=2`` 表示只检查总增益的正负值；若为负值即表示负极性，则反转
   所有数据的正负号但不修改 ``cmpaz`` 或 ``cmpinc``\ ；
-  ``n=3`` 表示同时检查 ``cmpaz`` 或 ``cmpinc`` 以及
   总增益的正负值，仅当其中之一符合负极性的要求时才做校正；

需要注意，正负极性的概念仅适用于6个标准分量方向。对于垂向分量而言，通常
需要校正极性，否则在查看 Z 分量的波形数据时，可能会出现某个台站的波形极性
不对的状况；对于水平向分量而言，由于通常会旋转到大圆路径方向，所以不做
极性校正，也不会有问题。总之，建议使用 ``-z 1`` 选项做极性校正。

用法示例
--------

从 SEED 文件中提取波形数据和 RESP 仪器响应文件：

.. code-block:: console

    rdseed -R -d -f infile.seed

其中，选项 ``-R -d -f`` 可以合写成 ``-Rdf``\ 。

从 SEED 文件中提取波形数据和 SAC PZ 仪器响应文件：

.. code-block:: console

    rdseed -pdf infile.seed

从 miniSEED 文件中提取波形数据，并指定 dataless SEED 文件作为仪器响应文件：

.. code-block:: console

    rdseed -Rdf infile.miniseed -g infile.dataless

警告与错误
----------

使用 ``rdseed`` 的过程中可能会遇到一些警告和错误。这些警告和错误
会显示在终端，也会记录到日志文件 ``rdseed.err_log`` 中。

警告1
~~~~~

::

    Warning... Azimuth and Dip out of Range on AAK,BH1
    Defaulting to subchannel identifier (for multiplexed data only)

若分量的 ``cmpaz`` 和 ``cmpinc`` 所指定的传感轴方向与垂直方向
的偏差很小，比如偏差在两度以内，则将该分量的方位码设置为 ``Z``\ 。
对于近正东西和近南北方向，设置分量方位码为 ``E`` 和 ``N``\ 。

若分量的敏感轴方向不与垂直向、正东西向、正南北向相近，则会出现此警告，
此时可能会设置分量的范围码为 ``1`` 或其他的字符。因而该警告可忽略。

警告2
~~~~~

::

    Warning... Azimuth/Dip Reversal found FURI.BHZ, Data inversion was not selected

该警告表示，根据分量的 ``cmpaz`` 和 ``cmpinc`` 检测到当前分量
是负极性，但不对数据作极性校正。这种情况下使用 ``-z 1`` 选项，会
修改数据的正负号，并将台站角度修改为正极性方向。
