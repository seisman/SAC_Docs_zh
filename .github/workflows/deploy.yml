#
# Build and deploy the documentation
#
name: Deploy

on:
  pull_request: # enable pull_request for testing
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash -l {0}
    steps:
      # Cancel previous runs that are not completed
      - name: Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.9.0

      - name: Checkout
        uses: actions/checkout@v2.3.4

      - name: Set up Python
        uses: actions/setup-python@v2

      # Install Python packages and Source Code Pro fonts
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          sudo git clone --branch release --depth 1 'https://github.com/adobe-fonts/source-code-pro.git' /usr/share/fonts/opentype
          fc-cache -f -v

      - name: Build HTML documentaiton
        run: make build_html

      - name: Install TinyTeX
        uses: r-lib/actions/setup-tinytex@v1

      - name: Install LaTeX packages
        run: |
          tlmgr install capt-of ctex datetime2 enumitem everysel fancyhdr \
                        fandol float ms needspace oberdiek parskip tabulary \
                        titlesec tracklang ulem upquote varwidth wrapfig \
                        xcolor xecjk zhnumber

      - name: Build PDF documentaiton
        run: make build_pdf
