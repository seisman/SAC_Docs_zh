\section{震相拾取}
\label{sec:phase-picking}
相关命令：\nameref{cmd:plotpk}

震相拾取，或者说标定到时，是SAC的一种常用功能。

要进行震相拾取，需要进入``ppk模式''：
启动SAC，读取波形数据后，在终端中键入plotpk(简写为ppk)，就会出现一个绘图窗口
(如果之前没有打开绘图窗口，这个绘图窗口就成为当前窗口)。
此时，SAC就进入了ppk模式。

在介绍怎样在ppk模式中拾取震相前，先说明如何退出ppk模式，以便读者对ppk模式中命令的输入有初步认识。
要退出ppk模式，首先确保绘图窗口为当前窗口，将鼠标移入窗口中，按``q''就退出，也不需要回车。
这时，读者可以看看终端，又恢复了以前的样子。

\begin{SACCode}
SAC> fg seis
SAC> ppk        // 进入ppk模式
// 光标保持在绘图窗口上，按``q''就退出ppk模式
SAC> q          // 退出SAC
\end{SACCode}

请注意：
读者可以观察一下，ppk模式时，在终端输入任何命令，回车后，SAC返回的都是一个空行。
进入ppk模式后，在终端中键入任何命令都是无效的。
ppk模式中的命令都不在终端中输入，而是在绘图窗口中输入。

下面介绍如何在ppk模式中拾取震相：
按上面的介绍进入ppk模式，鼠标(光标)移入绘图窗口内，确定应该在何处标定到时后，移动到该处，依次按下``t''、``0''，该处即出现一条竖线，旁边有标示：``T0''，
再按下``q''以退出ppk模式。在终端键入``wh''以保存。
这样鼠标所在处的时刻即写入到头段变量t0中。SAC中供给用户标定自定义时刻的头段变量是t0到t9(详见表~\ref{table:plotpk-commands}，其中有ppk模式支持的所有命令)。
注意：ppk模式的命令几乎都是由单个字符组成的，比如退出``q''(唯一的例外是命令``t''，由字符``t''和0-9的整数构成)。

\begin{SACCode}
SAC> fg seis
SAC> ppk
// 键入``t''和``0''标记到时，然后按``q''退出ppk模式
SAC> wh         // 保存头段
\end{SACCode}
以上是标定到时的基本操作。下面介绍一些保证到时标定准确的必要技巧。

首先，建议读者将移入绘图窗口内的鼠标(光标)设置成交叉瞄准线的形式。也就是像玩射击游戏时，你看到的枪炮的十字准心那样。

在``\nameref{sec:sac-install}''一节中
提到的SAC全局变量~\verb+SAC_PPK_USE_CROSSHAIRS+可以控制该光标的形态。当此全局
变量为0时，光标形态为一小十字
``\tikz[scale=0.3]{
    \draw[very thick] (0,0) -- (1,0);
    \draw[very thick] (0.5,-0.5) -- (0.5,0.5);
}''；当此全局变量为1时，会在0的基础上再加上水平和垂直线。将其值设置为1即可。
注意：改为十字准心后，要留意在输入``t''时，鼠标(光标)不仅要在窗口内，还要在波形图的图形内，否则会得到`` Bad cursor position. Please retry.''的错误提示。

其次，是图幅的放大(和缩小)。有时数据时间较长，鼠标(光标)只要移动一点就会有很大偏差，使得到时不易确定。
这时，就需要图幅的放大。首先需要将光标移动到绘图区域中的某位置，键入``x''，再移动至另一位置，
再次键入``x''。这样，两次键入就确定了一个时间窗。这时，绘图窗口中将只显示该时间窗内的波形，也就实现了图幅的放大。
可不断重复此步骤，进行多次放大。101.5之后的版本有更方便的方式：在绘图窗口中某位置按下鼠标左键，
并拖动至另一位置再松开鼠标左键，则两个位置之间的时间窗内的波形会被放大。
缩小通过``o''来实现，``o''最多可以回退5次绘图历史。

然后，就是同一台站的三个分量的数据要一次标定。同一台站的三个分量的数据上的某震相的到时自然是在同一时刻。所以把他们画一起在，就可以相互比较，利于震相的识别；
标定时一次标定，对应头段的值完全相等，这也符合到时相同的事实。
使用命令``ppk p 3 r m''进入ppk模式即可3个分量一次画图和一次标定。
进入ppk模式后，标定方式和前面类似。

\begin{SACCode}
SAC> dg sub teleseis ntkl.[nez] nykl.[nez] onkl.[nez] sdkl.[nez]
SAC> ppk p 3 r m
// 键入一次``t0''为全部波形标记到时，然后按``q''退出ppk模式
SAC> wh
SAC> q
\end{SACCode}

一般情况下，我们需要为很多台站的数据标定到时。
如果一个个台站读入，然后标定，再退出ppk模式，最后保存，就要做很多重复工作。
如果文件名已经改名为台站名开头，可以一次读入全部数据。
用命令``ppk p 3 r m''进入ppk模式，一次画三个数据。
这三个数据会恰好属于同一个台。
这个台的数据标定完以后，按``n''就可以标定下一个台。
全部标定后，再退出ppk模式，``wh''保存。

\begin{table}[H]
\centering
\small
\ttfamily
\caption{ppk模式命令一览表}
\label{table:plotpk-commands}
\begin{tabular}{cll}
	\toprule
    命令	&	含义	                                &   说明    \\
	\midrule
    a	    &	定义事件初至a                           &   1,7	    \\
    b	    &	如果有，则显示上一张绘图	            &           \\
    c	    &	计算事件的初至和结束                    &   1,4,7	\\
    d	    &	设置震相方向为DOWN	                    &           \\
    e     	&	设置震相起始为EMERGENT(急始)	        &           \\
    f	    &	定义事件结束f                           &  1,2,3,7	\\
    g	    &	以HYPO格式将拾取显示到终端              &   4   	\\
    h   	&	将拾取写成HYPO格式                      &   3,4 	\\
    i	    &	设置震相起始为IMPULSIVE	                &           \\
    j	    &	设置噪声水平                            &   2,6,8	\\
    k       &   即kill，退出ppk模式                     &           \\
    l	    &	显示光标当前位置                        &   2,4	    \\
    m	    &	计算最大振幅波形                        &   2,3,5	\\
    n	    &	显示下一绘图	                        &           \\
    o	    &	显示前一个绘图窗，最多可以保存5个绘图窗	&           \\
    p	    &	定义P波到时                             &   1,2,3,7	\\
    q	    &	即quit，退出ppk模式	                            &           \\
    s	    &	定义S波到时                             &   1,2,3,7 \\
    t	    &	用户自定义到时tn，输入t之后需要输入0到9中的任一数	&   1,2,7\\
    u	    &	设置震相方向为UP	                    &           \\
    v	    &	定义一个Wood-Anderson波形               &   2,5 	\\
    w	    &	定义一个通用波形                        &   2,5 	\\
    x	    &	使用一个新的x轴时间窗，简单说就是放大。 &           \\
    z	    &	设置参考水平                            &   2,6,8	\\
    \textbackslash	    &	删除当前全部拾取的定义。当一个文件中包含多个事件时有用。&	\\
    +	    &	设置震相方向为PLUS	                    &           \\
    -	    &	设置震相方向为MINUS	                    &           \\
    \lstinline[showspaces]! !   &	设置震相方向为NEUTRAL	                &           \\
    n	    &	设置震相质量为n，n取0-4	                &           \\
	\bottomrule
\end{tabular}
\end{table}

ppk模式经常使用的命令包括``b''、``l''、``n''、``o''、``q''、``t''和``x''。

不同的命令效果可能不同，有些会在绘图窗口显示信息，有些会将信息写入头段变量，
下面对表~\ref{table:plotpk-commands}~中的说明进行一个说明：
\begin{description}
    \item [1] 会将信息写入头段变量
    \item [2] 写入字符型震相拾取文件(若已打开)
    \item [3] 写入HYPO格式震相拾取文件(若已打开)
    \item [4] 在绘图窗口中显示信息
    \item [5] 窗口显示包含波形的矩形
    \item [6] 在指定的水平处放置水平光标
    \item [7] 绘图窗口显示含有到时标识的垂直线
    \item [8] 绘图窗口显示含有标识的水平线
\end{description}
